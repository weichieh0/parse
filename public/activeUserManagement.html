<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <script src="scripts/parse-1.6.14.min.js"></script>
    <script src="scripts/hbParseInit.js"></script>
    <script src="scripts/hbUtility.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>

    <!-- Latest compiled and minified CSS -->
    <!--<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">-->
    <!-- Optional theme -->
    <!--<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css" integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous">-->
    <!-- Latest compiled and minified JavaScript -->
    <!--<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>-->

    <script src="scripts/jquery-2.2.0.min.js"></script>
    <script src="scripts/bootstrap.min.js"></script>
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/bootstrap-theme.min.css" rel="stylesheet">


    <title>小蜜蜂小幫手</title>

    <style>
        .ui-widget-header, .ui-state-default, ui-button {
            background: #faa732;
            border: 1px solid #faa732;
            color: #FFFFFF;
            Font-family: Ms Gothic;
            /*font-weight: bold;*/
        }
    </style>
</head>
<body>

    <ul class="nav nav-pills">
        <li role="presentation" class="dropdown">
            <a class="dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">
                訂單查詢 <span class="caret"></span>
            </a>
            <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
                <li><a href="index.html?mode=id">訂單編號</a></li>
                <li><a href="index.html?mode=date">訂單日期</a></li>
            </ul>
        </li>

        <li role="presentation" class="dropdown">
            <a class="dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">
                帳單查詢 <span class="caret"></span>
            </a>
            <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
                <li><a href="storeBill.html">店家帳單</a></li>
                <li><a href="beeShippingFee.html">小蜜蜂帳單</a></li>
            </ul>
        </li>

        <li role="presentation" class="dropdown">
            <a class="dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">
                銀行匯款 <span class="caret"></span>
            </a>
            <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
                <li><a href="bankTransfer_store.html">店家匯款</a></li>
                <li><a href="bankTransfer_bee.html">小蜜蜂匯款</a></li>
            </ul>
        </li>

        <li role="presentation"><a href="storeManagement.html">店鋪管理</a></li>

        <li role="presentation" class="dropdown"><a href="beeManagement.html">小蜜蜂管理</a></li>

        <li role="presentation" class="dropdown active"><a href="activeUserManagement.html">活動紀錄查詢</a></li>
        <li role="presentation" class="dropdown">
            <a class="dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">
                其他 <span class="caret"></span>
            </a>
            <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
                <li><a href="coupon.html" target=_blank>折價卷產生器</a></li>
                <li><a href="holdOrderTool.html" target=_blank>卡單小幫手</a></li>
                <li><a href="" onclick="parseLogOut()">登出</a></li>
            </ul>
        </li>
    </ul>


    <div class="panel panel-default">
        <div class="panel-heading">小蜜蜂活動紀錄</div>

        <div class="panel-body">
            <div class="navbar-form navbar-left">
                <!--<div class="form-group">

                    <span class="label label-primary">1</span><br />
                    <label>電話:</label>
                    <input type="text" class="form-control" placeholder="請輸入小蜜蜂電話" id="phoneInput">
                    <button type="submit" class="btn btn-default" id="beeSearchBtn1">查詢</button>
                </div>

                <p> or </p>-->

                <div class="form-group">

                    <!--<span class="label label-primary">1</span><br>-->

                    <label for="dateFrom">時間: </label>
                    <input id="dateFrom" type="date" class="form-control" min="2015-01-02">
                    <label for="sel1">~</label>
                    <input id="dateTo" type="date" class="form-control" min="2015-01-02"><br>

                    <label for="sel1">分類:</label>
                    <select class="form-control" id="sel1">
                        <option value="all">All</option>
                        <option value="App Launcher">App Launcher</option>
                        <option value="Push Open-New Order">Push Open-New Order</option>
                        <option value="Upgrade App">Upgrade App</option>
                        <option value="New Installation">New Installation</option>
                        <option value="Store">店家</option>
                    </select>

                    <button type="submit" class="btn btn-default" id="beeSearchBtn2">查詢</button>
                </div>
            </div>

        </div>

        <div class="panel-foot">
            <table class="table table-striped ">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>時間</th>
                        <th>名字</th>
                        <th>動作</th>
                        <th>合格</th>
                        <th>裝置</th>
                        <th>版本</th>
                        <th>備註</th>
                    </tr>
                </thead>
                <tbody id="beeTableBody"></tbody>
            </table>
        </div>

    <script>

        $(function () {

            //var parseInit = function () {
            //    Parse.initialize("9O3uQHctMnz86F6m3lifIlwKrMGONwlUjO2OL4uf", "nbkR1HRcOkFEa4J73rPsWvaZsqa6O6BHI0GSGClz");
            //}

            var init = function () {
                //parseInit();
            }

            init();

            $('#beeSearchBtn2').click(function () {
                console.log("beeSearchBtn onclick");

                $("#beeTableBody tr").remove();
                var dateFrom = new Date($("#dateFrom").val());
                var dateTo = new Date($("#dateTo").val());
                dateTo.setDate(dateTo.getDate() + 1);



                var query = new Parse.Query("HBActiveUser");
                query.include("owner");
                query.include("installation");
                query.greaterThan("createdAt", dateFrom);
                query.lessThan("createdAt", dateTo);
                query.descending("createdAt");
                query.limit(1000);

                var selVal = $("#sel1").val();
                if (selVal == "Store") {
                    query.equalTo("appName","店家小蜜蜂");
                } else if (selVal != "all") {
                    query.notEqualTo("appName", "店家小蜜蜂");
                    query.equalTo("action", selVal);
                } else {
                    query.notEqualTo("appName", "店家小蜜蜂");
                }

                query.find({

                    success: function (actives) {
                        console.log("actives size : " + actives.length);
                    
                        actives.forEach(function (active, index, array) {

                            var nameHtml;
                            if (active.get('owner').get('contact') == null) {
                                nameHtml = active.get('owner').get('username');
                            } else {
                                nameHtml = $('<a href=beeInfo.html?objectId=' + active.get('owner').id + ' target=_blank>').html(active.get('owner').get('contact'));
                            }
                            var qualify = active.get('owner').get('qualify') ? "合格" : "未合格";

      
                            $('#beeTableBody').append(
                            $('<tr>').append(
                                $('<td>').html(index + 1), //#
                                $('<td>').html(format(active.get('createdAt'), 'yyyy-MM-dd hh:mm')),
                                //$('<td>').html($('<a href=beeInfo.html?objectId=' + active.get('owner').id + ' target=_blank>').html(active.get('owner').get('contact'))),
                                $('<td>').html(nameHtml),
                                $('<td>').html(active.get('action')),
                                $('<td>').html(qualify),
                                $('<td>').html(active.get('device')),
                                $('<td>').html(active.get('appVersion')),
                                $('<td>').html(active.get('remark'))
                            )
                         );
                        });

                    }, error: function (error) {
                        console.log(error);

                    }
                });

            });


        })
    </script>


        
        
        </body>
</html>